# **PROMPT 4.1 — Backend Domain Foundations: Speech Repository + Service**

### Summary Context

EPIC-4 requires a `SpeechBlock` persistence layer → repository, service, composable.
User already has profile, experiences, stories, canvas data.

### Purpose

Implement CRUD logic to store and update speech text generated by AI.

### Components/Composables to create

- `SpeechBlockRepository.ts`
- `SpeechBlockService.ts`
- `useSpeechEngine.ts`

### Pages

None yet → backend only.

### Instructions

- follow same architecture as STARStory domain
- implement:
  - createSpeechBlock(userId)
  - updateSpeechBlock
  - findSpeechBlockByUserId
  - deleteSpeechBlock
- internal validation:
  - elevatorPitch ≤ 600 chars
  - careerStory ≤ 2,000 chars
  - whyMe ≤ 1,200 chars

### Testing

- Vitest: repository + service
- run fake GraphQL engine
- mock Amplify errors

### Acceptance

- All CRUD functions stable
- All domain types typed
- No formatting logic in backend
- Composable exposes:
  - generateSpeech()
  - loadSpeech()

### Scope guard

NOT generating UI, not calling AI, not styling text.

---

---

# **PROMPT 4.2 — AI Operation: implement `ai.generateUserSpeech` Lambda**

### Summary

Create Lambda based on AIC addition above.

### Purpose

Produce speech JSON using full identity dataset.

### Components

- Lambda function in `/amplify/data/ai-operations/generateUserSpeech.ts`
- JSON validation layer
- error wrapper
- retry if schema mismatch

### Pages

none yet

### Instructions

- follow Lambda pattern from `generatePersonalCanvas`
- use system + user prompt structure
- max token limit ~900 words
- validate output length
- forbid job/company references

### Testing

- unit tests with fake AI provider
- schema validation
- malformed response retry

### Acceptance criteria

- Operation runs end-to-end
- User receives 3 blocks
- no hallucination
- strictly uses provided identity
- stored into SpeechBlock

### Scope guard

Do NOT add tailoring. Do NOT add UI logic. Do NOT update profile.

---

---

# **PROMPT 4.3 — Frontend Page: `/speech` initial builder page**

### Summary

Expose user speech to front end.

### Purpose

First editable page enabling:

- AI-generated material load
- manual editing
- save

### Components to create

- `<SpeechEditor.vue>`
- `<SpeechLayout.vue>`

### Composables

- useSpeechEngine()

### Pages

`/applications/speech`

### Instructions

- textarea editors
- 3 sections tabs
- save button
- regenerate speech button

### Testing

- component mount + save logic
- field validation
- loading skeletons

### Acceptance criteria

- speech appears after generation
- edits persist
- no user data loss
- all navigation rules match CV/Letter patterns

### Scope guard

NO tailoring, NO job selection, NO formatting beyond textarea.

---

---

# **PROMPT 4.4 — UI Enhancement: Editable speech blocks**

### Summary

Give granular control & UX.

### Purpose

Enable tagging, shortening, preview.

### Components

- `<SpeechBlockCard.vue>`
- `<SpeechPreview.vue>`

### Pages

same `/applications/speech`

### Instructions

- auto word count
- warning icons if > limit
- undo/redo support
- preview in interview mode formatting

### Testing

- snapshot tests
- word count tests
- overflow alerts

### Acceptance

- clean short outputs
- intuitive editing
- UX consistent with CV builder

### Scope guard

NO export, NO PDF

---

## MASTER PROMPT 5A.1 — Implement `ai.parseJobDescription`

### Context & Purpose

Implement the **single AI operation responsible for job understanding**.

`ai.parseJobDescription` takes **raw job description text** and returns a fully structured representation of the role, directly matching the `JobDescription` model.

This is the **only AI operation** for EPIC 5A.
Its output is stored directly on the `JobDescription` entity.

### Components / Composables

- AI operations layer (Lambda)
- AI operations repository/service
- Types shared between Lambda and frontend/domain

### Pages

None (backend / AI only).

### What to Implement

- Create or update the Lambda implementing `ai.parseJobDescription`.
- The AI must:
  - Extract **only what is explicitly present** in the job description.
  - Populate the following fields:
    - `title`
    - `seniorityLevel`
    - `roleSummary` (short synthesized description of the role)
    - `responsibilities`
    - `requiredSkills`
    - `behaviours`
    - `successCriteria`
    - `explicitPains`
    - `aiConfidenceScore`

- Output must be **structured JSON only**, validated and normalized.
- Missing fields must result in empty arrays or empty strings, never hallucinated content.
- Confidence score reflects extraction quality (not user fit).

### Acceptance Criteria

- AI output maps **1-to-1** to `JobDescription` fields.
- Lambda applies defaults for missing values.
- Operation is exposed through Amplify / GraphQL.
- Unit tests cover:
  - Full JD
  - Partial JD
  - Poorly structured JD

- No other AI operation is required for EPIC 5A.

---

## MASTER PROMPT 5A.2 — Implement Job Domain Layer (`JobDescription`)

### Context & Purpose

Implement the **Job domain layer** around the simplified `JobDescription` model.

This layer is responsible for:

- Persisting raw job descriptions
- Storing AI-parsed job structure
- Managing job lifecycle (`draft → analyzed → complete`)

### Components / Composables

To create or complete:

- `JobDescriptionRepository`
- `JobService`
- `useJobAnalysis` composable

Reuse patterns from:

- Experience domain
- PersonalCanvas domain

### Pages

None yet (domain only).

### What to Implement

- Repository:
  - CRUD operations on `JobDescription`

- Service:
  - Create job from raw text
  - Attach parsed AI data to job
  - Update job fields after user edits
  - Re-run AI parsing on existing `rawText`

- Composable (`useJobAnalysis`):
  - Reactive state: jobs list, selected job, loading/error
  - Methods:
    - `createJobFromRawText(rawText)`
    - `loadJob(jobId)`
    - `listJobs()`
    - `updateJob(jobId, patch)`
    - `reanalyseJob(jobId)`

### Acceptance Criteria

- A job can exist with `rawText` only (`draft`).
- After AI parsing, job status becomes `analyzed`.
- All job fields persist correctly.
- Domain layer matches patterns used elsewhere in the app.

---

## MASTER PROMPT 5A.3 — Implement `/jobs/new` (Add Job Description)

### Context & Purpose

Create the **entry point for EPIC 5A**.

Users paste a job description and trigger AI analysis.
On success, they are redirected to the job detail page.

### Components / Composables

- Nuxt UI form components
- `useJobAnalysis` composable

### Pages

- Create: `/jobs/new`

### What to Implement

- UI:
  - Large textarea for job description
  - Primary CTA: “Analyze job”
  - Loading and error states

- Logic:
  - Validate minimal input length
  - Create `JobDescription` with `rawText`
  - Call `ai.parseJobDescription`
  - Store parsed fields on job
  - Redirect to `/jobs/:id`

- UX:
  - Disable submit while processing
  - Clear error feedback on failure

### Acceptance Criteria

- User can paste a JD and trigger analysis.
- Job is persisted with parsed fields.
- Redirect happens only after successful parsing.
- Invalid or too-short input does not call AI.

---

## MASTER PROMPT 5A.4 — Implement `/jobs` Job List Page

### Context & Purpose

Provide users with an overview of all jobs they’ve added and analyzed.

This page is the navigation hub for job-related workflows.

### Components / Composables

- List or table UI component
- `useJobAnalysis` composable

### Pages

- Create: `/jobs`

### What to Implement

- Display a list of jobs showing:
  - Title
  - Seniority
  - Status (`draft`, `analyzed`, `complete`)

- Actions:
  - Add job → `/jobs/new`
  - Open job → `/jobs/:id`
  - Delete job (with confirmation)

- Empty state with CTA to add first job.

### Acceptance Criteria

- All jobs load correctly for the user.
- Navigation works without full page reload.
- Deleting a job removes it from the list immediately.
- UI remains consistent with other list pages (experiences, CVs).

---

## MASTER PROMPT 5A.5 — Implement `/jobs/:id` Job Detail & Role Card View

### Context & Purpose

This page is the **Job Role Card UI**, backed directly by `JobDescription`.

Users can:

- Review AI-parsed job structure
- Edit any extracted field
- Re-run AI analysis from original JD

### Components / Composables

- Nuxt UI:
  - Tabs
  - Tag/list editors
  - Inputs / textareas

- `useJobAnalysis` composable

### Pages

- Create: `/jobs/[id]`

### What to Implement

- Header:
  - Job title (editable)
  - Seniority level
  - Role summary (editable)

- Tabbed sections:
  - Responsibilities
  - Required skills
  - Behaviours
  - Success criteria
  - Explicit pains

- Editing:
  - User can add/remove/edit list items
  - Changes persist to backend

- Reanalyse:
  - Button “Reanalyse from original JD”
  - Confirms overwrite
  - Calls `ai.parseJobDescription` again using `rawText`

### Acceptance Criteria

- Page loads job data correctly.
- All fields are editable and persist.
- Reanalyse overwrites AI-generated fields only.
- No secondary entity (JobRoleCard) is used anywhere.

---

## MASTER PROMPT 5A.6 — Validation & Guardrails

### Context & Purpose

Ensure job data is **safe and usable** for downstream EPICs (5C, 6, 7).

### Components / Composables

- `useJobAnalysis`
- Job service validation helpers

### Pages

Applies to `/jobs/new` and `/jobs/:id`.

### What to Implement

- Validation rules:
  - Minimum JD length before AI call
  - Title must not be empty after analysis
  - Empty arrays allowed, but flagged in UI

- Status management:
  - `draft`: rawText only
  - `analyzed`: AI fields populated
  - `complete`: user has reviewed/edited (manual toggle or implicit)

### Acceptance Criteria

- Invalid data never breaks later workflows.
- Warnings are visible but non-blocking.
- Job always remains in a consistent state.

---

## MASTER PROMPT 5A.7 — Documentation & Contract Alignment

### Context & Purpose

Ensure all docs and contracts reflect the simplified architecture.

### Components

- Documentation files
- AI Interaction Contract

### Pages

None.

### What to Implement

- Update AI Interaction Contract:
  - Remove `ai.generateJobRoleCard`
  - Ensure `ai.parseJobDescription` fully documents all job fields

- Update diagrams and EPIC descriptions:
  - “Job Role Card” = UI view, not entity

- Ensure naming consistency across docs:
  - No reference to JobRoleCard entity remains

### Acceptance Criteria

- Documentation matches code and schema.
- No dangling references to removed AI ops or models.
- EPIC 5A reads coherently end-to-end.
