# **PROMPT 4.1 — Backend Domain Foundations: Speech Repository + Service**

### Summary Context

EPIC-4 requires a `SpeechBlock` persistence layer → repository, service, composable.
User already has profile, experiences, stories, canvas data.

### Purpose

Implement CRUD logic to store and update speech text generated by AI.

### Components/Composables to create

- `SpeechBlockRepository.ts`
- `SpeechBlockService.ts`
- `useSpeechEngine.ts`

### Pages

None yet → backend only.

### Instructions

- follow same architecture as STARStory domain
- implement:
  - createSpeechBlock(userId)
  - updateSpeechBlock
  - findSpeechBlockByUserId
  - deleteSpeechBlock
- internal validation:
  - elevatorPitch ≤ 600 chars
  - careerStory ≤ 2,000 chars
  - whyMe ≤ 1,200 chars

### Testing

- Vitest: repository + service
- run fake GraphQL engine
- mock Amplify errors

### Acceptance

- All CRUD functions stable
- All domain types typed
- No formatting logic in backend
- Composable exposes:
  - generateSpeech()
  - loadSpeech()

### Scope guard

NOT generating UI, not calling AI, not styling text.

---

---

# **PROMPT 4.2 — AI Operation: implement `ai.generateUserSpeech` Lambda**

### Summary

Create Lambda based on AIC addition above.

### Purpose

Produce speech JSON using full identity dataset.

### Components

- Lambda function in `/amplify/data/ai-operations/generateUserSpeech.ts`
- JSON validation layer
- error wrapper
- retry if schema mismatch

### Pages

none yet

### Instructions

- follow Lambda pattern from `generatePersonalCanvas`
- use system + user prompt structure
- max token limit ~900 words
- validate output length
- forbid job/company references

### Testing

- unit tests with fake AI provider
- schema validation
- malformed response retry

### Acceptance criteria

- Operation runs end-to-end
- User receives 3 blocks
- no hallucination
- strictly uses provided identity
- stored into SpeechBlock

### Scope guard

Do NOT add tailoring. Do NOT add UI logic. Do NOT update profile.

---

---

# **PROMPT 4.3 — Frontend Page: `/speech` initial builder page**

### Summary

Expose user speech to front end.

### Purpose

First editable page enabling:

- AI-generated material load
- manual editing
- save

### Components to create

- `<SpeechEditor.vue>`
- `<SpeechLayout.vue>`

### Composables

- useSpeechEngine()

### Pages

`/applications/speech`

### Instructions

- textarea editors
- 3 sections tabs
- save button
- regenerate speech button

### Testing

- component mount + save logic
- field validation
- loading skeletons

### Acceptance criteria

- speech appears after generation
- edits persist
- no user data loss
- all navigation rules match CV/Letter patterns

### Scope guard

NO tailoring, NO job selection, NO formatting beyond textarea.

---

---

# **PROMPT 4.4 — UI Enhancement: Editable speech blocks**

### Summary

Give granular control & UX.

### Purpose

Enable tagging, shortening, preview.

### Components

- `<SpeechBlockCard.vue>`
- `<SpeechPreview.vue>`

### Pages

same `/applications/speech`

### Instructions

- auto word count
- warning icons if > limit
- undo/redo support
- preview in interview mode formatting

### Testing

- snapshot tests
- word count tests
- overflow alerts

### Acceptance

- clean short outputs
- intuitive editing
- UX consistent with CV builder

### Scope guard

NO export, NO PDF

---
