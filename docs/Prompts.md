# **PROMPT 4.1 — Backend Domain Foundations: Speech Repository + Service**

### Summary Context

EPIC-4 requires a `SpeechBlock` persistence layer → repository, service, composable.
User already has profile, experiences, stories, canvas data.

### Purpose

Implement CRUD logic to store and update speech text generated by AI.

### Components/Composables to create

- `SpeechBlockRepository.ts`
- `SpeechBlockService.ts`
- `useSpeechEngine.ts`

### Pages

None yet → backend only.

### Instructions

- follow same architecture as STARStory domain
- implement:
  - createSpeechBlock(userId)
  - updateSpeechBlock
  - findSpeechBlockByUserId
  - deleteSpeechBlock
- internal validation:
  - elevatorPitch ≤ 600 chars
  - careerStory ≤ 2,000 chars
  - whyMe ≤ 1,200 chars

### Testing

- Vitest: repository + service
- run fake GraphQL engine
- mock Amplify errors

### Acceptance

- All CRUD functions stable
- All domain types typed
- No formatting logic in backend
- Composable exposes:
  - generateSpeech()
  - loadSpeech()

### Scope guard

NOT generating UI, not calling AI, not styling text.

---

---

# **PROMPT 4.2 — AI Operation: implement `ai.generateUserSpeech` Lambda**

### Summary

Create Lambda based on AIC addition above.

### Purpose

Produce speech JSON using full identity dataset.

### Components

- Lambda function in `/amplify/data/ai-operations/generateUserSpeech.ts`
- JSON validation layer
- error wrapper
- retry if schema mismatch

### Pages

none yet

### Instructions

- follow Lambda pattern from `generatePersonalCanvas`
- use system + user prompt structure
- max token limit ~900 words
- validate output length
- forbid job/company references

### Testing

- unit tests with fake AI provider
- schema validation
- malformed response retry

### Acceptance criteria

- Operation runs end-to-end
- User receives 3 blocks
- no hallucination
- strictly uses provided identity
- stored into SpeechBlock

### Scope guard

Do NOT add tailoring. Do NOT add UI logic. Do NOT update profile.

---

---

# **PROMPT 4.3 — Frontend Page: `/speech` initial builder page**

### Summary

Expose user speech to front end.

### Purpose

First editable page enabling:

- AI-generated material load
- manual editing
- save

### Components to create

- `<SpeechEditor.vue>`
- `<SpeechLayout.vue>`

### Composables

- useSpeechEngine()

### Pages

`/applications/speech`

### Instructions

- textarea editors
- 3 sections tabs
- save button
- regenerate speech button

### Testing

- component mount + save logic
- field validation
- loading skeletons

### Acceptance criteria

- speech appears after generation
- edits persist
- no user data loss
- all navigation rules match CV/Letter patterns

### Scope guard

NO tailoring, NO job selection, NO formatting beyond textarea.

---

---

# **PROMPT 4.4 — UI Enhancement: Editable speech blocks**

### Summary

Give granular control & UX.

### Purpose

Enable tagging, shortening, preview.

### Components

- `<SpeechBlockCard.vue>`
- `<SpeechPreview.vue>`

### Pages

same `/applications/speech`

### Instructions

- auto word count
- warning icons if > limit
- undo/redo support
- preview in interview mode formatting

### Testing

- snapshot tests
- word count tests
- overflow alerts

### Acceptance

- clean short outputs
- intuitive editing
- UX consistent with CV builder

### Scope guard

NO export, NO PDF

---

# PROMPT 5A-1 — Job Description Intake → Save Raw JD Text

### Context & Purpose

User pastes a job description into `/jobs/new`.
We must parse it into JobDescription.rawText and trigger AI parsing.

### Component/Composables

Used:

- `useJobAnalysis()` composable
  Components:
- Job Intake Component (page 2.2)

### Pages Impacted

- `/jobs/new` → create JD entry
- `/jobs/:id` → view results later

### Implementation Instructions

- Save raw text string into JobDescription entity.
- Validate non-empty text.
- Trigger `ai.parseJobDescription` with `{ jobText }`.
- Store AI output into JobDescription fields.

### Acceptance Criteria

- Raw JD saved to DB.
- AI call fired successfully.
- Responsibilities / skills / behaviours stored.
- Job list displays job title extracted by AI.

---

---

# PROMPT 5A-2 — AI Parsing of Job Description

### Context & Purpose

Convert job posting into structured data.

### Components / Composables

- `useJobAnalysis().parseJobDescription()`

### Page

- `/jobs/new`

### Implementation

- Call `ai.parseJobDescription` updated schema.
- Write mapping function:
  raw → mapped fields:
  responsibilities, skills, behaviours, successCriteria, pains, seniority, title.
- Save output to JobDescription entry.

### Acceptance Criteria

- AI output validated via schema.
- Seniority always present (even “unknown”).
- Title extracted in 90% of cases.
- Responsibilites length ≥ 3 if present in text.

---

---

# PROMPT 5A-3 — Build JobRoleCard Generator

### Context & Purpose

Turn parsed data into a user-facing Job Role Card.

### Components

- Job Role Card Component (Page 2.3)

### Pages

- `/jobs/:id`

### Implementation

- Create `ai.generateJobRoleCard` call.
- Summarise job into structured fields.
- Add AI confidence score.
- Store under JobRoleCard entity.

### Acceptance Criteria

- Summary produced ≤ 120 words.
- All fields must map 1-to-1 to CDM node names.
- Card visible on page with tabs.

---

---

# PROMPT 5A-4 — Manual Editing UI

### Context & Purpose

Users must edit extracted fields.

### Components

- `<UTabs>` based editor
- Job Role Card Component

### Pages

- `/jobs/:id`

### Implementation

- Editable lists for:
  responsibilities, skills, behaviours, success criteria, pains
- Versioning not required.
- Tag input for array fields.

### Acceptance Criteria

- User can add/remove items.
- Autosave at field level.
- UI validation handles empty entries.

---

---

# PROMPT 5A-5 — Connect Job → Company (optional field stub)

### Context & Purpose

EPIC 5C will require relational linking.

### Components/Composables

- useJobAnalysis
- useCanvasEngine (later)

### Pages

- `/jobs/:id`

### Implementation

- Add dropdown for company selection (optional)
- Save companyId FK onto JobDescription

### Acceptance Criteria

- No AI required yet.
- Relationship persists.

---

---

# PROMPT 5A-6 — Data Refresh Logic

### Context

User may update JD text after first parsing.

### Components

- `useJobAnalysis()`

### Pages

- `/jobs/:id`

### Implementation

- Add "Reanalyse" button
- Re-run AI pipeline overwriting existing fields

### Acceptance Tests

- Output regenerates fully
- Confirm overwrite warning shown
- UI refresh without page reload

---

---

# PROMPT 5A-7 — Business Rules Validation

### Purpose

Prevent bad data downstream.

### Implementation

Validation rules:

- minimum JD words: 80
- responsibilities count ≥ 3 OR flag warnings
- success criteria must be non-empty OR propagate “not provided”

### Acceptance Criteria

- Warning banners visible
- Stored data remains valid JSON
- No frontend crashes
